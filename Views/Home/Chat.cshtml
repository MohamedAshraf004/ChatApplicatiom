@model Chat
<div class="chat-body">


    @foreach (var msg in Model.Messages)
    {
        <div class="messgae">
            <header>
                @msg.Name :
            </header>
            <p>
                @msg.Text
            </p>
            <footer>
                @msg.TimeStamp
            </footer>
        </div>

    }
    <form class="chat-input fixed-bottom" method="post" asp-action="AddMessage" asp-controller="Home">
        <input type="text" name="message" />
        <button type="submit">Send</button>
        <input type="hidden" name="chatId" asp-for="@Model.Id" />
    </form>
</div>


@section Scripts{
<script src="~/js/signalr.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript">
    "use strict";

    var connection = new signalR.HubConnectionBuilder().withUrl("/chatHub").build();
    var _connectionId = '';

    connection.on("ReceiveMessage", function (data) {
        console.log(data);
    })


    var joinRoom = function () {
        var url = '/Chat/JoinRoom/' + _connectionId + '/@Model.Name';
        axios.post(url,null)
            .then(res => {
                console.log("Joined Room".res)
            }).
            catch(err => {
                console.log("Failed to join room",res)
            })
    }


    connection.start().then(function () {
        connection.invoke('getConnectionId')
            .then(function (connectionId) {
                _connectionId = connectionId
                joinRoom();

            })
    }).catch(function (err) {
        return console.error(err.toString());
    });


    //Disable send button until connection is established
    //document.getElementById("sendButton").disabled = true;

    //connection.on("ReceiveMessage", function (user, message) {
    //    var msg = message.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
    //    var encodedMsg = user + " says " + msg;
    //    var li = document.createElement("li");
    //    li.textContent = encodedMsg;
    //    document.getElementById("messagesList").appendChild(li);
    //});

    //connection.start().then(function () {
    //    document.getElementById("sendButton").disabled = false;
    //}).catch(function (err) {
    //    return console.error(err.toString());
    //});

    //document.getElementById("sendButton").addEventListener("click", function (event) {
    //    var user = document.getElementById("userInput").value;
    //    var message = document.getElementById("messageInput").value;
    //    connection.invoke("SendMessage", user, message).catch(function (err) {
    //        return console.error(err.toString());
    //    });
    //    event.preventDefault();
    //});
</script>
}